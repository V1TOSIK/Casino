<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–°–ª–æ—Ç-–≥—Ä–∞ üé∞</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    background: radial-gradient(circle at top, #1e293b, #0f172a);
  }
</style>
</head>
<body class="h-screen flex justify-center items-center relative text-white overflow-hidden">

<div
  class="relative z-10 bg-gray-800 p-8 rounded-2xl shadow-2xl flex flex-col items-center max-w-lg w-full"
>

  <!-- –ë–∞–ª–∞–Ω—Å -->
  <div class="mb-4 text-lg">–ë–∞–ª–∞–Ω—Å: <span id="balance">1000</span> –º–æ–Ω–µ—Ç</div>

  <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞–≤–æ–∫ —ñ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—ñ–Ω—ñ–≤ -->
  <div class="mb-6 flex gap-4 items-center flex-wrap justify-center">
    <label for="betAmount" class="text-lg">–°—Ç–∞–≤–∫–∞:</label>
    <input
      id="betAmount"
      type="number"
      min="1"
      value="10"
      class="border rounded p-2 w-24 text-black"
    />

    <label for="multiSpin" class="text-lg">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—ñ–Ω—ñ–≤:</label>
    <select
      id="multiSpin"
      class="border rounded p-2 w-24 bg-white text-black"
    ></select>
  </div>

  <!-- –°—ñ—Ç–∫–∞ 3x3 —Å–ª–æ—Ç—ñ–≤ -->
  <div id="slotGrid" class="grid grid-cols-3 gap-6 mb-6">
    <!-- –¢—É—Ç —Å—Ç–≤–æ—Ä–∏–º–æ 9 —Å–ª–æ—Ç—ñ–≤ -->
  </div>

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
  <div
    id="result"
    class="text-2xl font-semibold mt-4 h-8 mb-6 text-center"
  ></div>

  <!-- –ö–Ω–æ–ø–∫–∞ SPIN -->
  <button
    id="spinBtn"
    class="bg-gradient-to-br from-yellow-400 to-yellow-600 text-white font-bold text-xl px-12 py-4 rounded-full shadow-[0_5px_0_#92400e] active:translate-y-[3px] active:shadow-[0_2px_0_#78350f] active:bg-gradient-to-br active:from-yellow-600 active:to-yellow-800 transition-all duration-150 cursor-pointer select-none"
  >
    SPIN üéØ
  </button>
</div>

<script>
const symbolsList = ['üçí', 'üçã', 'üçâ', 'üçä', '‚≠ê', '7Ô∏è‚É£', 'üîî'];
const symbolHeight = 110;
const visibleSymbols = 30;
const rows = 3;
const cols = 3;

const balanceEl = document.getElementById('balance');
const spinBtn = document.getElementById('spinBtn');
const resultText = document.getElementById('result');
const multiSpinSelect = document.getElementById('multiSpin');
const slotGrid = document.getElementById('slotGrid');

let balance = 1000;
let isSpinning = false;

// –°—Ç–≤–æ—Ä—é—î–º–æ select –¥–ª—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—ñ–Ω—ñ–≤ 1-10
for(let i=1; i<=10; i++) {
  const option = document.createElement('option');
  option.value = i;
  option.textContent = i;
  multiSpinSelect.appendChild(option);
}

// –°—Ç–≤–æ—Ä—é—î–º–æ 9 —Å–ª–æ—Ç—ñ–≤ —É —Å—ñ—Ç—Ü—ñ
for(let i=0; i < rows * cols; i++) {
  const reel = document.createElement('div');
  reel.className = "reel relative w-[110px] h-[110px] rounded-xl bg-white shadow-lg overflow-hidden";
  reel.id = 'slot' + (i+1);
  
  const symbols = document.createElement('div');
  symbols.className = "symbols absolute top-0 left-0 w-full flex flex-col h-[3300px]";
  
  // –î–æ–¥–∞—î–º–æ —Å–∏–º–≤–æ–ª–∏ —É –∫–æ–∂–µ–Ω —Å–ª–æ—Ç
  for (let j = 0; j < visibleSymbols; j++) {
    const div = document.createElement('div');
    div.className = 'symbol h-[110px] flex items-center justify-center text-4xl';
    div.textContent = symbolsList[j % symbolsList.length];
    symbols.appendChild(div);
  }

  reel.appendChild(symbols);
  slotGrid.appendChild(reel);
}

const reels = Array.from(document.querySelectorAll('.reel'));
let currentPositions = new Array(rows * cols).fill(0);

// –û–Ω–æ–≤–ª—é—î–º–æ –±–∞–ª–∞–Ω—Å —É DOM
function updateBalance() {
  balanceEl.textContent = balance;
}

spinBtn.addEventListener('click', startSpin);

function startSpin() {
  if (isSpinning) return;

  const bet = parseInt(document.getElementById('betAmount').value);
  const spinsCount = parseInt(multiSpinSelect.value);
  if (isNaN(bet) || bet <= 0) {
    alert('–í–≤–µ–¥—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É —Å—Ç–∞–≤–∫—É!');
    return;
  }
  if (isNaN(spinsCount) || spinsCount <= 0) {
    alert('–í–∏–±–µ—Ä—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—ñ–Ω—ñ–≤!');
    return;
  }
  const totalBet = bet * spinsCount;
  if (totalBet > balance) {
    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª–∞–Ω—Å—É!');
    return;
  }

  balance -= totalBet;
  updateBalance();

  isSpinning = true;
  resultText.textContent = '';

  let spinResults = [];
  let completedSpins = 0;

  function spinOnce(spinIndex) {
    const results = new Array(rows * cols);
    let reelsCompleted = 0;

    reels.forEach((reel, index) => {
      const symbols = reel.querySelector('.symbols');
      const totalSymbols = symbolsList.length;
      const randomIndex = Math.floor(Math.random() * totalSymbols);
      const fullSpins = 3 + index;
      const targetPos = currentPositions[index] + fullSpins * totalSymbols + randomIndex;

      animateReel(symbols, currentPositions[index], targetPos, 2000 + index * 200, () => {
        currentPositions[index] = targetPos % totalSymbols;
        results[index] = symbolsList[currentPositions[index]];
        reelsCompleted++;
        if (reelsCompleted === reels.length) {
          spinResults.push(results);
          completedSpins++;
          if (completedSpins < spinsCount) {
            spinOnce(completedSpins);
          } else {
            processResults(spinResults, bet);
            isSpinning = false;
          }
        }
      });
    });
  }

  spinOnce(0);
}

// –ê–Ω—ñ–º–∞—Ü—ñ—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω—É
function animateReel(element, from, to, duration, onComplete) {
  const totalSymbols = symbolsList.length;
  const distance = to - from;
  const startTime = performance.now();

  function update(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const eased = 1 - Math.pow(1 - progress, 3);
    const position = from + distance * eased;
    const offset = -(position % totalSymbols) * symbolHeight;
    element.style.transform = `translateY(${offset}px)`;

    if (progress < 1) requestAnimationFrame(update);
    else onComplete();
  }
  requestAnimationFrame(update);
}

// –û–±—Ä–æ–±–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ 3x3 —Å—ñ—Ç—Ü—ñ
function processResults(allResults, bet) {
  let totalWin = 0;

  allResults.forEach(results => {
    // results ‚Äî –º–∞—Å–∏–≤ –¥–æ–≤–∂–∏–Ω–æ—é 9
    // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ —É 2D –º–∞—Å–∏–≤ 3x3
    const grid = [];
    for(let r=0; r<rows; r++) {
      grid[r] = results.slice(r*cols, r*cols + cols);
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–π (3 —Ä—è–¥–∫–∏) ‚Äî –º–Ω–æ–∂–∏–º–æ –≤–∏–≥—Ä–∞—à –Ω–∞ 3
    for(let r=0; r<rows; r++) {
      if(grid[r][0] === grid[r][1] && grid[r][1] === grid[r][2]) {
        totalWin += bet * 3;
      }
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª–µ–π (3 —Å—Ç–æ–≤–ø—Ü—ñ) ‚Äî –º–Ω–æ–∂–∏–º–æ –Ω–∞ 4
    for(let c=0; c<cols; c++) {
      if(grid[0][c] === grid[1][c] && grid[1][c] === grid[2][c]) {
        totalWin += bet * 4;
      }
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ–∞–≥–æ–Ω–∞–ª–µ–π ‚Äî –º–Ω–æ–∂–∏–º–æ –Ω–∞ 2
    if(grid[0][0] === grid[1][1] && grid[1][1] === grid[2][2]) {
      totalWin += bet * 2;
    }
    if(grid[0][2] === grid[1][1] && grid[1][1] === grid[2][0]) {
      totalWin += bet * 2;
    }
  });

  if (totalWin > 0) {
    resultText.textContent = `üéâ –í–∏–≥—Ä–∞—à –∑–∞ ${allResults.length} —Å–ø—ñ–Ω(—ñ–≤): +${totalWin} –º–æ–Ω–µ—Ç!`;
    resultText.className = 'text-green-400 font-bold text-2xl mt-4 text-center';
  } else {
    resultText.textContent = 'üò¢ –ù—ñ—á–æ–≥–æ, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ!';
    resultText.className = 'text-red-400 font-bold text-2xl mt-4 text-center';
  }
  balance += totalWin;
  updateBalance();
}

updateBalance();
</script>
</body>
</html>
